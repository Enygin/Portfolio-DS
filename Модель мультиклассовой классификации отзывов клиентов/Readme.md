# Итоги по исследованию и обучению модели мультиклассовой классификации отзывов клиентов

## Задача
Одним из приоритетов бизнеса компании является создание лучшего клиентского опыта, поэтому для компании важно понимать текущий уровень `CSI` (*customer satisfaction index*) и его динамику (для оценки эффекта изменений в бизнес-процессах).  
С этой целью, разработан автоматический механизм сбора обратной связи по заказам. Кроме общей оценки удовлетворённости, клиенты оставляют обратную связь в виде текстового комментария/отзыва в свободной форме. 
 
 Необходимо обучить модель классификации негативных отзывов, которая позволит получать детальную аналитику по проблемам клиентов в автоматическом режиме.
 
Для решения данной задачи была проведена работа по анализу датасета с негативными отзывами клиентов и построена бейзлайновая модель мультиклассовой классификации.

## Предобработка данных и EDA  
**Данные**   
В нашем распоряжении датасет с 2837 отзывами, из которых 15 оказались дубликатами. Необходимо отметить, что текст отзывов повторялся несколько раз, но уникальные идентификаторы `id` отличались. Проверка истории появления этих отзывов позволит понять природу появления повторяющихся отзывов и устранить возможность многократной подачи одинакового отзыва.

Было изучено среднее количество слов в отзыве:
* наиболее часто модель будет иметь дело с короткими отзывами примерно в 10 слов
* основная масса отзывов находится в диапазоне от 2 до 25 слов на отзыв
* отзывы больше 25 слов встречаются реже и по мере увеличения количества слов в отзыве, количества самих отзывов уменьшается.
* отзывы свыше 100 слов единичны
* средние показатели:
  * мода - 4 слова в отзыве
  * среднее арифметическое - 32
  * медиана - 21
  * стандартное отклонение - 33
* максимальное количество слов в отзыве - 188. Такой отзыв один.

**Анализ дисбаланса классов**
Проведено исследование дисбаланса классов:
* Два класса заметно выделяются по количеству отзывов. Это `"Компетентность продавцов/ консультантов"` (821 отзыв) и `"Вежливость сотрудников магазина"` (495 отзывов). 
* Следующие по популярности 4 класса не имеют такого сильного разрыва и лежат в диапазоне 263 - 304 отзыва (`"Время ожидания у кассы"` (304), `"Доступность персонала в магазине"` (291), `"Обслуживание продавцами/ консультантами"` (267), `"Электронная очередь"` (263)
* Тематика "Обслуживание на кассе" собрала 211 отзывов и заняла предпоследнее место
* Наименьше всего клиенты жаловались на "Консультацию КЦ" - всего 170 отзывов.

Такой дисбаланс может восприниматься как нормальное для бизнеса явление - где воронка клиентов шире, там и жалоб больше. Однако для построения модели машинного обучения этот дисбаланс необходимо устранить.

## Подготовка данных для обучения моделей
Текст отзывов был очищен - оставлены только русские символы, удалены стоп-слова.

Для проведения корректной лемматизации слов была проведена дополнительная проверка текста на наличие ошибок и опечаток.  
С помощью библиотеки `SpellChecker` были найдены некорректные слова, из которых после исключения сленговых, разговорных и англоязычных слов был составлен словарь из 233 слов с ошибками или опечатками, по которому тест был скорректирован.

После данной работы текст отзывов был лемматизирован.

Изучены облака слов по каждому классу отзывов.  
Популярность слов в зависимости от темы отзыва имеет свои отличия. Например, слово "очередь" встречается только в двух релевантных контексту классах - "Время ожидания у кассы" (350 раз) и "Электронная очередь" (219 раз).  
Слово "талон" самое популярное в классе "Электронная очередь" и больше не встречается в ТОП-10 по популярности слов в других классах.

Кроме характерной уникальности слов для соответствующего класса встречаются слова, которые вошли в ТОП-10 популярных слов во всех классах. Например, слово "сотрудник" и "магазин". Популярны также слова "товар" и "заказ" - они вошли в ТОП-10 популярных слов почти во всех классах.

**Обучающая и тестовая выборки**  
Данные были поделены на обучающую и тестовую выборки в пропорциях 75/25 соответственно. При разделении данные были стратифицированы по целевому классу, чтобы пропорции классов были сохранены и в равной мере были представлены в обучающей и тестовой выборках.

Для оценки важности слов данные были закодированы двумя способами: мешка слов (n_gram) и с помощью взвешивания слов TF-IDF.

## Обучение моделей машинного обучения
В качестве бейзлайновых моделей мультиклассовой классиикации были построены две модели на основе метода опорных векторов и простая логистическая регрессия:
* `LinearSVC`
* `SVC`
* `LogisticRegression`

Для подбора гиперпараметров использовался метод `GridSearchCV`.  
В качестве метрики оценки определим *f1_micro* - она рассчитывает показатели глобально, подсчитывая общее количество истинно положительных, ложноотрицательных и ложноположительных результатов.  
Дополнительно замерялось время обучения моделей.

Как и предполагалось, представление корпуса текста в виде мешка слов показало плохие результаты - метрика f1 не превышает 0.55. 
На TF-IDF обучение происходит быстрее и метрика f1 значительно выше - 0.79 у *LinearSVC* и по 0.80 у *LogisticRegression* и *SVC*. 

## Выбор и тестирование лучшей модели 
Были протестированы обе модели, f1-метрика которых 0.80.

Обе модели одинаково ошибаются в сторону мажоритарных классов - "`Компетентность продавцов/консультанстов`" и "`Вежливость сотрудников магазина`". Это говорит о необходимости устранения дисбаланса классов.

Сравнивая две модели с одинаковым средним показателем метрики f1 предпочтение было отдано модели *LogisticRegression* - она немного точнее классифицировала миноритарные классы и меньше подвержена смещению в сторону мажоритарных классов. Кроме этого обучение модели логистической регрессии происходит практически мгновенно.

* лучше всего модель *LogisticRegression* показала себя на определении трех классов:
  * "`Электронная очеред`" - f1-score 0.89, 56 верных классификаций и 10 ошибок 
  * "`Время ожидания у кассы`" - f1-score 0.89, 72 верных классификаций и 5 ошибок
  * "`Консультация КЦ`" - f1-score 0.88, 37 верных классификаций и 6 ошибок (один раз отзыв неверно классифицирован как "`Вежливость сотрудников магазина`" и пять раз как "`Компетентность продавцов/ консультантов`", который является самым большим по количеству классов. 

* хуже всего модель справилась с одним классом: 
  * "`Обслуживание продавцами/ консультантами`" - f1-score 0.62. Здесь из 67 отзывов модель верно классифицировала только 35 (52%), неверно отнеся 16 отзывов к самому большому классу "`Компетентность продавцов/ консультантов`" и 9 отзывов отнесла к классу "`Доступность персонала в магазине`".
 
Обученная модель *LogisticRegression* и признаки *TF-IDF*, на которых обучалась модель, выгружены для построения пайплайна использования модели для классификации поступающих отзывов в автоматическом режиме.

**Дальнейшая работа по совершенствованию модели**
1. Устранить дисбаланс классов. Представляется, что лучшим решением будет обогатить датасет реальными отзывами.
2. Обучить модели, потребующие большей вычислительной мощности. Например, модель BERT может показать более высокие результаты.
