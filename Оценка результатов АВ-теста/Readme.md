# Отчет по исследованию результатов А/В-теста тестирования новой рекомендательной системы

## Задача  
Компания внедряет улучшенную рекомендательную систему товаров. Для проверки гипотезы, что с ней новые пользователи за две недели с момента регистрации покажут рост основных метрик более чем на 10%, было проведено А/В-тестирование. Необходимо оценить корректность его проведения согласно технического задания и проанализировать результаты теста.


## Данные
Для целей настоящего исследования компанией было представлено 4 датасета с информацией о: 
* зарегистрированных пользователях в период с 7 по 21 декабря 2020 года;
* действиях новых пользователей в период с 7 декабря 2020 по 4 января 2021 года;
* проводимых компанией маркетинговыми событиями за 2020 год;
* участниках тестов с указанием в каком тесте и в какой группе был пользователь.

Представленные данные можно считать корректными - в них нет дубликатов и пропусков. Датасеты испешно объединяются по идентификатору клиента. Потребовалось привести к типу данных *datetime* столбцы с датами и временем различных событий.

## Проверка соответствия техническому заданию

Техническое задание на проведение A/B-теста состояло из 9 пунктов, соблюдение которых было проверено

**Название теста и группы**  
По техническому заданию тест должен называться `recommender_system_test`, а группы: А (контрольная), B (новая платёжная воронка).

Условие технического задания выполнено - в представленных данных (датасет `df_participants`) имеется информация об исследуемом тесте `recommender_system_test`.  
В нем есть две группы: А (3824 пользователя) и В (2877 пользователей), количество пользователей в группе А больше на 24%.  
Всего в тесте приняло участие 6701 пользователь.

Однако кроме исследуемого теста в этом датасете есть еще информация о 11,5 тыс пользователей, принявших участие в другом проводимом в это же время тесте - `interface_eu_test`.

Анализ пересечения пользователей между тестами показал, что 1602 пользователя одновременно приняли участие в двух тестах. Учитывая, что мы точно не можем сказать, какой из экспериментов повлиял на принятие того или иного решения пользователем, для чистоты эксперемента пересекающиеся между тестами пользователи были исключены из анализа.

После очистки данных у нас осталось 5099 пользователей-участников тесте `recommender_system_test`.  
Внутри теста пользователи не пересекаются, но количество пользователей в группах распределилось не равномерно. В группе А (контрольная группа) присутствует 2903 пользователей (57%), а в группе В (новая платежная воронка) - 2196 пользователей (43%).

**Дата запуска теста**  
По условиям технического задания тест должен был начаться 7 декабря 2020 года. 

Это условие было проверено по информация о дате регистрации новых пользователей.  
Дата запуска теста (начала регистрации новых пользователей) соответствует техническому заданию - 7 декабря 2020 года.  
Регистрация событий у новых пользователей началась в полночь.


**Дата остановки набора новых пользователей**  
По условиям технического задания набор новых пользователей должен был остановиться 21 декабря 2020 года. 

Соблюдение этого условия также было проверено по информация о дате регистрации новых пользователей - регистрация новых пользователей завершилась 21 декабря 2020 года, что соответствует техническому заданию.  

В группе А количество регистраций новых пользователей было больше в каждый день за исключением одного дня - 10 декабря. Ежедневное изменение количества регистраций новых пользователей между группами выглядит симметрично. В обоих группах по понедельникам наблюдается всплеск регистраций новых пользователей.

**Дата остановки теста**  
По условиям технического задания тест должен был быть остановлен 4 января 2021 года. 

Это условие было проверено на основании информацию о дате совершения событий пользователями (датасет `df_event`). Дата остановки теста (максимальная дата регистрации событий) - 30 декабря 2020 года (время 23:36), что не соответствует техническому заданию.  

Либо тест был остановлен на 5 дней раньше, либо часть данных отсутствует - эту информацию необходимо уточнить дополнительно.

По техническому заданию ожидаемый эффект от тестирования: за 14 дней с момента регистрации пользователи покажут улучшение каждой метрики. Отсутствие информации за последние 5 дней приводит к тому, что в отношении пользователей, зарегистрировавшихся после 16 декабря, нет части информации о прохождении ими всего лайфтайма в оговоренные 14 дней, что не в полной мере дает возможность оценить как внесенные изменения повлияли на их активность. 

**Аудитория**  
Согласно технического задания в тест должно быть отобрано 15% новых пользователей из региона *EU*.

Если рассматривать долю отобранных пользователей из Европы на очищенных данных (исключены наблюдения после 21 декабря и удалены пользователи, попавшие одновременно в два теста), то условие технического задания отобрать 15% новых пользователей из региона *EU* не выполнено - эта доля составляет 11,22%.

В то же время, если не удалять пользователей, принявших участие в двух одновременно проводимых тестах, то условие технического задания отобрать 15% новых пользователей из региона *EU* выполнено - оно составляет ровно 15%.

Вероятно, что при отборе пользователей из Европы на этапе проведения теста счетчик отбора таких пользователей отработал корректно, но была допущена ошибка в другом месте, в связи с чем это условие будем считать не соответствующим техническому заданию.

В исследуемом тесте приняли участи пользователи из четырех регионов:
* Европа - 4749 пользователей (93% от всех пользователей, принявших участие в тесте);
* Северная Америка - 223 пользователя, 4%;
* Азиатско-Тихоакеанический регион - 72, 1%;
* СНГ - 55, 1%.

Чаще всего пользователи регистрировались с *Android* (45% от всех регистраций), на втором месте по популярности - *PC* (25%), затем *Iphone* (21%) и реже всего пользователи регистрировались с *Mac* (9%).


**Количество участников теста**  
Согласно технического задания ожидаемое количество участников теста должно составлять 6000 пользователей.

Это условие выполняется на датасете с пользователями, попавшими в два теста одновременно - таких пользователей 6701.  
Если исключить из датасета повторяющихся пользователей, то условие технического задания не выполняется - количество участников теста на 901 участника меньше ожидаемыого порога в 6000. Таким образом условие не выполнено в силу некорректного распределения пользователей между одновременно проводимыми тестами.

**Время проведения теста**  
Была изучена возможность влияния на результаты теста проводимые в это же время маркетинговые кампании. 

Исследуемый тест проводился с 7 декабря и должен был завершиться 4 января (информация об активности пользователей доступна по 30 декабря).  
Во время проведения теста проводились два маркетинговых события:
* *CIS New Year Gift Lottery*: 
  * начало 30 декабря 2020 года - это последний день, за который доступна информация о поведении пользователей-участников теста
  * регион проведения *CIS* (СНГ). В исследуемом тесте доля пользователей из этого региона составляет 1%
* *Christmas&New Year Promo*:
  * начало 25 декабря 2020 года - здесь длительность пересечения маркетингового события с проведением теста составляет 6 дней 
  * регион проведения *EU* и *N.America*. В исследуемом датасете 93% участников теста были из Европы и 4% из Северной Америки.

Акция, проводимая с 30 декабря в регионе CIS (СНГ) будет иметь незаметный эффект на результаты теста, поскольку пользователей из этого региона в исследуемом тестировании всего лишь 1% и пересечение по времени приходится на один последний день проведения тестирования.  

Кампания *Christmas&New Year Promo* могла повлиять на активность и поведение пользователей с 25.12 по 30.12 - в эти дни идет пересечение времени проведения тестирования и маркетинговой кампании. Кроме того, эта кампания проводилась в самом многочисленном регионе - *EU* (Европа). Доля пользователей-частников теста из этого региона составляет 93%. Эта кампания также проводилась в регионе *N.America* (Северная Америка), что охватывает 4% участников теста из этого региона. Анализ активности пользователей в период проведения данной кампании идет на спад. Кроме того необходимо учтесть, что маркетинговое событие повлияло на обе группы одновременно.

**Назначение теста, ожидаемый эффект**  

В процессе исследования воронки было выявлено 2311 неактивных пользователей - это участники эксперимента, которые зарегистрировались, но не проявили никакой активности после регистрации.  
2311 неактивных пользователей - это 45% от всех зарегистрированных в рамках исследуемого теста пользователей.  
С учетом того, что ценности для построения воронки событий такие пользователи не представляют, они были исключены из исследования. Из датасета также были исключены события пользователей, которые выходили за рамки оговоренного лайфтайма в 14 дней.

После очистки датасета от неактивных пользователей дисбаланс распределения пользователей в контрольной и тестовой групп сильно усугубился:
* в группе А (контрольная) оказался 821 неактивный пользователь;
* в группе В (новая платёжная воронка) оказалось 1490 неактивных пользователей.

После удаления неактивных пользователей в группе А (контрольная) стало находиться 79% участников теста, а в группе В (новая воронка продаж) - 21%.

Между группами наблюдаются отличия в активности пользователей:
* в группе А пользователи чаще совершали (расставлено в порядке убывания) по 6 и 4, 8, 9 и 12 активностей. В среднем на одного пользователя приходится 7 событий (медиана - 6 событий);
* в группе В - по 4, 6, 3, 2, 8. В среднем один пользователь совершает 5 событий (медиана - 4 события).

* В группе А аномальный рост активности начинается с 14 декабря. Пик активности приходится на 21 декабря, в этот день было совершено более 1500 событий. Затем активность идёт на спад. 
* В группе В таких резких всплесков не наблюдается, там события распределны более равномерно. Самое большое число событий в этой группе так же пришлось на 21 декабря и достигало более 300 событий.

14 декабря начался аномально резкий всплеск активности пользователей только в группе А. При этом данный всплеск не имеет пересечений с календарем маркетинговых событий, а дата сама дата приходится на понедельник, что также странно, поскольку большинство акций и распродаж начинаются в пятницу. Но в таком случае активность должна прослеживаться в обоих группах. Возможно причиной такого роста стал набор активных пользователей с 14 декабря - здесь стоит уточнить информацию о том, как осуществлялся набор и распределение пользователей между группами.

По условию технического задания ожидаемый эффект от внедрения новой рекомендательной системы - за 14 дней с момента регистрации пользователи покажут улучшение каждой метрики не менее, чем на 10%:
* конверсии в просмотр карточек товаров — событие `product_page`
* просмотры корзины — `product_cart`
* покупки — `purchase`

В группе А (контрольная) конверсия по всем этапам чуть лучше, чем в группе В (новая воронка продаж): 

1. Просмотр карточки товара.  
После авторизации в группе А к просмотру карточки товара переходит 65% пользователей. В группе В - 56% (меньше на 9%)

2. Переход в корзину.  
После авторизации к корзине доходят 30% пользователей в группе А и 28% в гурппе В (меньше на 2%). Однако, если рассматривать переход в корзину из карточки товара, то в группе А перешли 46% пользователей, а в группе В - 49% (на 3% больше).

3. Переход к покупке товара.
После авторизации в группе А до покупки дошли 31% пользователей, в группе В - 28% (меньше на 3%).  
Следует обратить внимание, что на этом этапе доля дошедших пользователей после авторизации немного больше доли пользователей, перешедших из корзины. Это говорить о том, что на платформе не строгая воронка продаж и можно приобрести продукт минуя некоторые этапы.

**С учетом полученных результатов, ожидаемый эффект не достигнут ни по одной метрике. Положительная динамика в 10% по каждому этапу не наблюдается.**


**Результаты статистических тестов**

Чтобы подтвердить наши выводы об отсутствии эффекта от улучшенной рекомендательной системы, протестированной на пользователях из группы В, была проверена статистическая разница долей Z-критерием с поправкой Бонферрони, уровень статистической значимости 5%.

Нулевая гипотеза - статистически значимых различий между группами А и В нет.  
Альтернативная гипотеза - различия между выбранными группами есть.

По результатам проведения статистического теста: 
* значимая разница между группами прослеживается только на этапе просмотра карточек товара. 
* на остальных этапах конверсии нет достаточных оснований считать, что есть разница между контрольной и экспериментальной группой.

## Вывод  
Учитывая несоответствие проведенного теста ряду условий технического задания, повлекшие сильных дисбаланс в тестируемой и контрольной группах, тест следует считать не состоявшимся.

Предлагается устранить ошибки, допущенные при провдеении теста:
* пользователь должен быть участником только одного проводимого теста;
* количество пользователей в контрольной и тестовой группах должно быть сбалансированно;
* тест должен останавливаться по завершению оговоренного на его проведение времени.

Ожидаемый эффект при соблюдении данных условий может отличаться от полученного.
